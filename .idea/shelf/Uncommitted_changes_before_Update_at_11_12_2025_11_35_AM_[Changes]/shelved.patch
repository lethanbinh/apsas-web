Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"AutoImportSettings\">\r\n    <option name=\"autoReloadType\" value=\"SELECTIVE\" />\r\n  </component>\r\n  <component name=\"ChangeListManager\">\r\n    <list default=\"true\" id=\"55c2a2ea-14a6-419e-8d9a-44362c500483\" name=\"Changes\" comment=\"Fix bugs and complete teacher assign\" />\r\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\r\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\r\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\r\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\r\n  </component>\r\n  <component name=\"Git.Settings\">\r\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\r\n  </component>\r\n  <component name=\"GitHubPullRequestSearchHistory\">{\r\n  &quot;lastFilter&quot;: {\r\n    &quot;state&quot;: &quot;OPEN&quot;,\r\n    &quot;assignee&quot;: &quot;lethanbinh&quot;\r\n  }\r\n}</component>\r\n  <component name=\"GithubPullRequestsUISettings\">{\r\n  &quot;selectedUrlAndAccountId&quot;: {\r\n    &quot;url&quot;: &quot;https://github.com/lethanbinh/apsas-web.git&quot;,\r\n    &quot;accountId&quot;: &quot;b93c1590-533c-40d5-8641-b6e4528e19d4&quot;\r\n  }\r\n}</component>\r\n  <component name=\"ProjectColorInfo\">{\r\n  &quot;customColor&quot;: &quot;&quot;,\r\n  &quot;associatedIndex&quot;: 5\r\n}</component>\r\n  <component name=\"ProjectId\" id=\"34y2piGTIdQL2zs7JFp8p6gVu7P\" />\r\n  <component name=\"ProjectViewState\">\r\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\r\n    <option name=\"showLibraryContents\" value=\"true\" />\r\n  </component>\r\n  <component name=\"PropertiesComponent\">{\r\n  &quot;keyToString&quot;: {\r\n    &quot;ModuleVcsDetector.initialDetectionPerformed&quot;: &quot;true&quot;,\r\n    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,\r\n    &quot;RunOnceActivity.git.unshallow&quot;: &quot;true&quot;,\r\n    &quot;git-widget-placeholder&quot;: &quot;main&quot;,\r\n    &quot;js.debugger.nextJs.config.created.client&quot;: &quot;true&quot;,\r\n    &quot;js.debugger.nextJs.config.created.server&quot;: &quot;true&quot;,\r\n    &quot;kotlin-language-version-configured&quot;: &quot;true&quot;,\r\n    &quot;node.js.detected.package.eslint&quot;: &quot;true&quot;,\r\n    &quot;node.js.detected.package.tslint&quot;: &quot;true&quot;,\r\n    &quot;node.js.selected.package.eslint&quot;: &quot;(autodetect)&quot;,\r\n    &quot;node.js.selected.package.tslint&quot;: &quot;(autodetect)&quot;,\r\n    &quot;nodejs_package_manager_path&quot;: &quot;npm&quot;,\r\n    &quot;vue.rearranger.settings.migration&quot;: &quot;true&quot;\r\n  }\r\n}</component>\r\n  <component name=\"RunManager\" selected=\"npm.Next.js: server-side\">\r\n    <configuration name=\"Next.js: debug client-side\" type=\"JavascriptDebugType\" uri=\"http://localhost:3000/\">\r\n      <method v=\"2\" />\r\n    </configuration>\r\n    <configuration name=\"Next.js: server-side\" type=\"js.build_tools.npm\">\r\n      <package-json value=\"$PROJECT_DIR$/package.json\" />\r\n      <command value=\"run\" />\r\n      <scripts>\r\n        <script value=\"dev\" />\r\n      </scripts>\r\n      <node-interpreter value=\"project\" />\r\n      <envs />\r\n      <method v=\"2\" />\r\n    </configuration>\r\n  </component>\r\n  <component name=\"SharedIndexes\">\r\n    <attachedChunks>\r\n      <set>\r\n        <option value=\"bundled-jdk-9823dce3aa75-bf35d07a577b-intellij.indexing.shared.core-IU-252.27397.103\" />\r\n        <option value=\"bundled-js-predefined-d6986cc7102b-3aa1da707db6-JavaScript-IU-252.27397.103\" />\r\n      </set>\r\n    </attachedChunks>\r\n  </component>\r\n  <component name=\"TaskManager\">\r\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\r\n      <changelist id=\"55c2a2ea-14a6-419e-8d9a-44362c500483\" name=\"Changes\" comment=\"\" />\r\n      <created>1762171678143</created>\r\n      <option name=\"number\" value=\"Default\" />\r\n      <option name=\"presentableId\" value=\"Default\" />\r\n      <updated>1762171678143</updated>\r\n      <workItem from=\"1762171679610\" duration=\"1697000\" />\r\n      <workItem from=\"1762178816952\" duration=\"4000\" />\r\n      <workItem from=\"1762229919429\" duration=\"69000\" />\r\n      <workItem from=\"1762230322334\" duration=\"5000\" />\r\n      <workItem from=\"1762270379353\" duration=\"165000\" />\r\n      <workItem from=\"1762310394294\" duration=\"3220000\" />\r\n      <workItem from=\"1762319614010\" duration=\"2218000\" />\r\n      <workItem from=\"1762326987903\" duration=\"676000\" />\r\n      <workItem from=\"1762393639073\" duration=\"2551000\" />\r\n      <workItem from=\"1762433359344\" duration=\"1424000\" />\r\n      <workItem from=\"1762444379590\" duration=\"73000\" />\r\n      <workItem from=\"1762482682788\" duration=\"1499000\" />\r\n      <workItem from=\"1762511425191\" duration=\"101000\" />\r\n      <workItem from=\"1762605144030\" duration=\"136000\" />\r\n      <workItem from=\"1762770321662\" duration=\"69000\" />\r\n    </task>\r\n    <task id=\"LOCAL-00001\" summary=\"Optimize speed and fix deploy\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1762172112476</created>\r\n      <option name=\"number\" value=\"00001\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00001\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1762172112476</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00002\" summary=\"Fix Bugs UI\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1762178718338</created>\r\n      <option name=\"number\" value=\"00002\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00002\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1762178718338</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00003\" summary=\"Fix bugs examiner role\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1762229980250</created>\r\n      <option name=\"number\" value=\"00003\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00003\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1762229980250</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00004\" summary=\"Exam shifts Management\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1762320024223</created>\r\n      <option name=\"number\" value=\"00004\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00004\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1762320024223</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00005\" summary=\"Fix build deploy\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1762321823335</created>\r\n      <option name=\"number\" value=\"00005\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00005\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1762321823335</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00006\" summary=\"Fix delete file\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1762323175701</created>\r\n      <option name=\"number\" value=\"00006\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00006\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1762323175701</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00007\" summary=\"Fix some UI bugs\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1762327000296</created>\r\n      <option name=\"number\" value=\"00007\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00007\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1762327000296</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00008\" summary=\"Fix UI admin\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1762327422065</created>\r\n      <option name=\"number\" value=\"00008\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00008\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1762327422065</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00009\" summary=\"Fix exam session. Do exam functions\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1762482761409</created>\r\n      <option name=\"number\" value=\"00009\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00009\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1762482761409</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00010\" summary=\"Fix bugs and complete teacher assign\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1762770351907</created>\r\n      <option name=\"number\" value=\"00010\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00010\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1762770351907</updated>\r\n    </task>\r\n    <option name=\"localTasksCounter\" value=\"11\" />\r\n    <servers />\r\n  </component>\r\n  <component name=\"TypeScriptGeneratedFilesManager\">\r\n    <option name=\"version\" value=\"3\" />\r\n  </component>\r\n  <component name=\"Vcs.Log.Tabs.Properties\">\r\n    <option name=\"TAB_STATES\">\r\n      <map>\r\n        <entry key=\"MAIN\">\r\n          <value>\r\n            <State>\r\n              <option name=\"FILTERS\">\r\n                <map>\r\n                  <entry key=\"branch\">\r\n                    <value>\r\n                      <list>\r\n                        <option value=\"main\" />\r\n                      </list>\r\n                    </value>\r\n                  </entry>\r\n                </map>\r\n              </option>\r\n            </State>\r\n          </value>\r\n        </entry>\r\n      </map>\r\n    </option>\r\n  </component>\r\n  <component name=\"VcsManagerConfiguration\">\r\n    <MESSAGE value=\"Optimize speed and fix deploy\" />\r\n    <MESSAGE value=\"Fix Bugs UI\" />\r\n    <MESSAGE value=\"Fix bugs examiner role\" />\r\n    <MESSAGE value=\"Exam shifts Management\" />\r\n    <MESSAGE value=\"Fix build deploy\" />\r\n    <MESSAGE value=\"Fix delete file\" />\r\n    <MESSAGE value=\"Fix some UI bugs\" />\r\n    <MESSAGE value=\"Fix UI admin\" />\r\n    <MESSAGE value=\"Fix exam session. Do exam functions\" />\r\n    <MESSAGE value=\"Fix bugs and complete teacher assign\" />\r\n    <option name=\"LAST_COMMIT_MESSAGE\" value=\"Fix bugs and complete teacher assign\" />\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/workspace.xml b/.idea/workspace.xml
--- a/.idea/workspace.xml	(revision fb5cf06ab6bd16fba48a33020918a07ce520669e)
+++ b/.idea/workspace.xml	(date 1762922149739)
@@ -96,6 +96,7 @@
       <workItem from="1762511425191" duration="101000" />
       <workItem from="1762605144030" duration="136000" />
       <workItem from="1762770321662" duration="69000" />
+      <workItem from="1762842716087" duration="220000" />
     </task>
     <task id="LOCAL-00001" summary="Optimize speed and fix deploy">
       <option name="closed" value="true" />
Index: src/components/student/AssignmentList.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>\"use client\";\r\n\r\nimport { LinkOutlined } from \"@ant-design/icons\";\r\nimport { Alert, App, Collapse, Spin, Typography } from \"antd\";\r\nimport dayjs from \"dayjs\";\r\nimport { useEffect, useState } from \"react\";\r\nimport styles from \"./AssignmentList.module.css\";\r\n\r\nimport { AssessmentFile, assessmentFileService } from \"@/services/assessmentFileService\";\r\nimport { ClassAssessment, classAssessmentService } from \"@/services/classAssessmentService\";\r\nimport { classService } from \"@/services/classService\";\r\nimport { CourseElement, courseElementService } from \"@/services/courseElementService\";\r\nimport { ExamSession, examSessionService } from \"@/services/examSessionService\";\r\nimport { AssignmentItem } from \"./AssignmentItem\";\r\nimport { AssignmentData } from \"./data\";\r\n\r\nconst { Title, Text } = Typography;\r\nconst { Panel } = Collapse;\r\n\r\nfunction mapCourseElementToAssignmentData(\r\n  element: CourseElement,\r\n  sessionMap: Map<number, ExamSession[]>,\r\n  filesMap: Map<number, AssessmentFile[]>,\r\n  classAssessmentMap: Map<number, ClassAssessment>,\r\n  classId: number\r\n): AssignmentData {\r\n  const sessions = sessionMap.get(element.id) || [];\r\n  const classAssessment = classAssessmentMap.get(element.id);\r\n  let deadline: string | undefined = undefined;\r\n  let startAt = dayjs().toISOString();\r\n  \r\n  // Get deadline from classAssessment only (last set deadline)\r\n  // If no classAssessment, there is no deadline\r\n  try {\r\n    if (classAssessment?.endAt) {\r\n      deadline = classAssessment.endAt;\r\n      startAt = classAssessment.startAt || dayjs().toISOString();\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Error parsing deadline:\", error);\r\n    // Continue without deadline\r\n  }\r\n  \r\n  const files = filesMap.get(element.id) || [];\r\n  \r\n  // Get requirement file and database file if available\r\n  const requirementFileObj = files.find(f => f.fileTemplate === 0);\r\n  const databaseFileObj = files.find(f => f.fileTemplate === 1);\r\n  const requirementFile = requirementFileObj?.name || \"\";\r\n  const databaseFile = databaseFileObj?.name || \"\";\r\n\r\n  return {\r\n    id: element.id.toString(),\r\n    status: classAssessment || sessions.length > 0 ? \"Active Assignment\" : \"Basic Assignment\",\r\n    title: element.name || \"Assignment\",\r\n    date: deadline,\r\n    description: element.description || \"No description available\",\r\n    requirementContent: [\r\n      { type: \"heading\", content: element.name || \"Assignment Details\" },\r\n      { type: \"paragraph\", content: element.description || \"\" },\r\n    ],\r\n    requirementFile: requirementFile,\r\n    requirementFileUrl: requirementFileObj?.fileUrl || \"\",\r\n    databaseFile: databaseFile || undefined,\r\n    databaseFileUrl: databaseFileObj?.fileUrl || \"\",\r\n    totalScore: \"N/A\",\r\n    overallFeedback: \"\",\r\n    gradeCriteria: [],\r\n    suggestionsAvoid: \"\",\r\n    suggestionsImprove: \"\",\r\n    submissions: [],\r\n    classAssessmentId: classAssessment?.id,\r\n    courseElementId: element.id,\r\n    classId: classId,\r\n    assessmentTemplateId: classAssessment?.assessmentTemplateId,\r\n    startAt: startAt,\r\n  };\r\n}\r\n\r\nexport default function AssignmentList() {\r\n  const { message } = App.useApp();\r\n  const [assignments, setAssignments] = useState<AssignmentData[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const fetchAssignments = async () => {\r\n      const classId = localStorage.getItem(\"selectedClassId\");\r\n      \r\n      if (!classId) {\r\n        setError(\"No class selected. Please select a class first.\");\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n\r\n        // 1) Get class info to find semesterCourseId\r\n        const cls = await classService.getClassById(classId);\r\n        const semesterCourseId = parseInt(cls.semesterCourseId, 10);\r\n\r\n        // 2) Get all course elements and filter by this class's semesterCourseId\r\n        const allElements = await courseElementService.getCourseElements({\r\n          pageNumber: 1,\r\n          pageSize: 1000,\r\n        });\r\n        const classElements = allElements.filter(\r\n          (el) => el.semesterCourseId === semesterCourseId\r\n        );\r\n\r\n        // 3) Load exam sessions for this class to attach deadlines and get assessmentTemplateIds\r\n        let sessionsByCourseElement = new Map<number, ExamSession[]>();\r\n        let assessmentTemplateIds = new Set<number>();\r\n        \r\n        try {\r\n          const sessionRes = await examSessionService.getExamSessions({\r\n            classId: Number(cls.id),\r\n            pageNumber: 1,\r\n            pageSize: 1000,\r\n          });\r\n          \r\n          for (const s of sessionRes.items) {\r\n            const arr = sessionsByCourseElement.get(s.courseElementId) || [];\r\n            arr.push(s);\r\n            sessionsByCourseElement.set(s.courseElementId, arr);\r\n            if (s.assessmentTemplateId) {\r\n              assessmentTemplateIds.add(s.assessmentTemplateId);\r\n            }\r\n          }\r\n        } catch (err) {\r\n          console.error(\"Failed to fetch exam sessions:\", err);\r\n          // Continue without exam sessions\r\n        }\r\n\r\n        // 4) Fetch assessment files for all assessment templates\r\n        const filesByCourseElement = new Map<number, AssessmentFile[]>();\r\n        const filesPromises = Array.from(assessmentTemplateIds).map(async (templateId) => {\r\n          try {\r\n            const filesRes = await assessmentFileService.getFilesForTemplate({\r\n              assessmentTemplateId: templateId,\r\n              pageNumber: 1,\r\n              pageSize: 100,\r\n            });\r\n            return { templateId, files: filesRes.items };\r\n          } catch (err) {\r\n            console.error(`Failed to fetch files for template ${templateId}:`, err);\r\n            return { templateId, files: [] };\r\n          }\r\n        });\r\n        \r\n        const filesResults = await Promise.all(filesPromises);\r\n        const templateToFilesMap = new Map<number, AssessmentFile[]>();\r\n        filesResults.forEach(({ templateId, files }) => {\r\n          templateToFilesMap.set(templateId, files);\r\n        });\r\n\r\n        // 5) Fetch class assessments for this class (wrap in try-catch to not block other data)\r\n        let classAssessmentMap = new Map<number, ClassAssessment>();\r\n        try {\r\n          const classAssessmentRes = await classAssessmentService.getClassAssessments({\r\n            classId: Number(cls.id),\r\n            pageNumber: 1,\r\n            pageSize: 1000,\r\n          });\r\n          for (const assessment of classAssessmentRes.items) {\r\n            if (assessment.courseElementId) {\r\n              classAssessmentMap.set(assessment.courseElementId, assessment);\r\n            }\r\n          }\r\n        } catch (err) {\r\n          console.error(\"Failed to fetch class assessments:\", err);\r\n          // Continue without class assessments - still show course elements\r\n        }\r\n\r\n        // 6) Map files to course elements via exam sessions\r\n        for (const element of classElements) {\r\n          const sessions = sessionsByCourseElement.get(element.id) || [];\r\n          const allFiles: AssessmentFile[] = [];\r\n          for (const session of sessions) {\r\n            if (session.assessmentTemplateId) {\r\n              const files = templateToFilesMap.get(session.assessmentTemplateId) || [];\r\n              allFiles.push(...files);\r\n            }\r\n          }\r\n          // Remove duplicates by id\r\n          const uniqueFiles = Array.from(\r\n            new Map(allFiles.map(f => [f.id, f])).values()\r\n          );\r\n          filesByCourseElement.set(element.id, uniqueFiles);\r\n        }\r\n\r\n        // 7) Map to AssignmentData\r\n        const mappedAssignments = classElements.map((el) =>\r\n          mapCourseElementToAssignmentData(el, sessionsByCourseElement, filesByCourseElement, classAssessmentMap, Number(cls.id))\r\n        );\r\n\r\n        setAssignments(mappedAssignments);\r\n      } catch (err: any) {\r\n        console.error(\"Failed to fetch assignments:\", err);\r\n        setError(err.message || \"Failed to load assignments.\");\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchAssignments();\r\n  }, []);\r\n\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className={styles.wrapper}>\r\n        <Spin size=\"large\" style={{ display: \"block\", textAlign: \"center\", padding: \"50px\" }} />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className={styles.wrapper}>\r\n        <Alert message=\"Error\" description={error} type=\"error\" showIcon />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={styles.wrapper}>\r\n      <Title\r\n        level={2}\r\n        style={{\r\n          fontWeight: 700,\r\n          color: \"#2F327D !important\",\r\n          marginBottom: \"20px\",\r\n        }}\r\n      >\r\n        Assignments\r\n      </Title>\r\n      {assignments.length === 0 ? (\r\n        <Alert message=\"No assignments found\" description=\"There are no assignments for this class.\" type=\"info\" />\r\n      ) : (\r\n        <Collapse\r\n          accordion\r\n          bordered={false}\r\n          className={styles.collapse}\r\n          defaultActiveKey={assignments.length > 0 ? [assignments[0].id] : []}\r\n        >\r\n          {assignments.map((item) => (\r\n            <Panel\r\n              key={item.id}\r\n              header={\r\n                <div className={styles.panelHeader}>\r\n                  <div>\r\n                    <Text\r\n                      type=\"secondary\"\r\n                      style={{ fontSize: \"0.9rem\", color: \"#E86A92\" }}\r\n                    >\r\n                      <LinkOutlined /> {item.status}\r\n                    </Text>\r\n                    <Title level={4} style={{ margin: \"4px 0 0 0\" }}>\r\n                      {item.title}\r\n                    </Title>\r\n                  </div>\r\n                </div>\r\n              }\r\n            >\r\n              <AssignmentItem data={item} />\r\n            </Panel>\r\n          ))}\r\n        </Collapse>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/components/student/AssignmentList.tsx b/src/components/student/AssignmentList.tsx
--- a/src/components/student/AssignmentList.tsx	(revision fb5cf06ab6bd16fba48a33020918a07ce520669e)
+++ b/src/components/student/AssignmentList.tsx	(date 1762914761707)
@@ -17,6 +17,24 @@
 const { Title, Text } = Typography;
 const { Panel } = Collapse;
 
+// Helper function to check if a course element is a Practical Exam based on name
+function isPracticalExam(element: CourseElement): boolean {
+  const name = (element.name || "").toLowerCase();
+  const keywords = [
+    "exam",
+    "pe",
+    "practical exam",
+    "practical",
+    "test",
+    "kiểm tra thực hành",
+    "thi thực hành",
+    "bài thi",
+    "bài kiểm tra",
+    "thực hành",
+  ];
+  return keywords.some((keyword) => name.includes(keyword));
+}
+
 function mapCourseElementToAssignmentData(
   element: CourseElement,
   sessionMap: Map<number, ExamSession[]>,
@@ -107,7 +125,7 @@
           pageSize: 1000,
         });
         const classElements = allElements.filter(
-          (el) => el.semesterCourseId === semesterCourseId
+          (el) => el.semesterCourseId === semesterCourseId && !isPracticalExam(el)
         );
 
         // 3) Load exam sessions for this class to attach deadlines and get assessmentTemplateIds
Index: src/components/examiner/AssignSubmissionsModal.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>\"use client\";\r\n\r\nimport {\r\n  GradingGroup,\r\n  GradingGroupSubmission,\r\n  gradingGroupService,\r\n} from \"@/services/gradingGroupService\";\r\nimport { submissionService } from \"@/services/submissionService\";\r\nimport { DeleteOutlined, FileZipOutlined, InboxOutlined } from \"@ant-design/icons\";\r\nimport type { TableProps, UploadFile, UploadProps } from \"antd\";\r\nimport {\r\n  Alert,\r\n  App,\r\n  Button,\r\n  Card,\r\n  Modal,\r\n  Popconfirm,\r\n  Space,\r\n  Table,\r\n  Tabs,\r\n  Tag,\r\n  Typography,\r\n  Upload\r\n} from \"antd\";\r\nimport Dragger from \"antd/es/upload/Dragger\";\r\nimport { useCallback, useEffect, useState } from \"react\";\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface AssignSubmissionsModalProps {\r\n  open: boolean;\r\n  onCancel: () => void;\r\n  onOk: () => void;\r\n  group: GradingGroup;\r\n  allGroups: GradingGroup[];\r\n}\r\n\r\nexport const AssignSubmissionsModal: React.FC<AssignSubmissionsModalProps> = ({\r\n  open,\r\n  onCancel,\r\n  onOk,\r\n  group,\r\n  allGroups,\r\n}) => {\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [fileList, setFileList] = useState<UploadFile[]>([]);\r\n  const [activeTab, setActiveTab] = useState<string>(\"list\");\r\n  const [submissions, setSubmissions] = useState<GradingGroupSubmission[]>([]);\r\n  const [loadingSubmissions, setLoadingSubmissions] = useState(false);\r\n  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);\r\n  const { message: messageApi } = App.useApp();\r\n\r\n  const fetchSubmissions = useCallback(async () => {\r\n    if (!group?.id) return;\r\n    \r\n    setLoadingSubmissions(true);\r\n    try {\r\n      // Fetch grading group by ID to get updated submissions\r\n      const updatedGroup = await gradingGroupService.getGradingGroupById(group.id);\r\n      setSubmissions(updatedGroup.submissions || []);\r\n    } catch (err: any) {\r\n      console.error(\"Failed to fetch submissions:\", err);\r\n      messageApi.error(\"Failed to load submissions\");\r\n    } finally {\r\n      setLoadingSubmissions(false);\r\n    }\r\n  }, [group?.id, messageApi]);\r\n\r\n  useEffect(() => {\r\n    if (open && group?.id) {\r\n      fetchSubmissions();\r\n      setFileList([]);\r\n      setError(null);\r\n      setActiveTab(\"list\");\r\n      setSelectedRowKeys([]);\r\n    }\r\n  }, [open, group?.id, fetchSubmissions]);\r\n\r\n  // Validate file name format: STUXXXXXX.zip (X is digit)\r\n  const validateFileName = (fileName: string): boolean => {\r\n    // Pattern: STU + 6 digits + .zip (case insensitive)\r\n    const pattern = /^STU\\d{6}\\.zip$/i;\r\n    return pattern.test(fileName);\r\n  };\r\n\r\n  // Validate file is ZIP and has correct name format\r\n  const beforeUpload: UploadProps[\"beforeUpload\"] = (file) => {\r\n    // Check file extension - must end with .zip\r\n    const fileName = file.name;\r\n    const isZipExtension = fileName.toLowerCase().endsWith(\".zip\");\r\n    \r\n    if (!isZipExtension) {\r\n      messageApi.error(\"Only ZIP files are accepted! Please select a file with .zip extension\");\r\n      return Upload.LIST_IGNORE;\r\n    }\r\n    \r\n    // Validate file name format: STUXXXXXX.zip\r\n    if (!validateFileName(fileName)) {\r\n      messageApi.error(`Invalid file name format! File name must be in format STUXXXXXX.zip (e.g., STU123456.zip). Current: ${fileName}`);\r\n      return Upload.LIST_IGNORE;\r\n    }\r\n    \r\n    // Check file size (max 100MB)\r\n    const isLt100M = file.size / 1024 / 1024 < 100;\r\n    if (!isLt100M) {\r\n      messageApi.error(\"File must be smaller than 100MB!\");\r\n      return Upload.LIST_IGNORE;\r\n    }\r\n    \r\n    return false; // Prevent auto upload\r\n  };\r\n\r\n  const handleFileChange: UploadProps[\"onChange\"] = (info) => {\r\n    // Keep all files that pass validation\r\n    const validFiles = info.fileList.filter(file => {\r\n      if (file.status === 'error') return false;\r\n      if (!file.name.toLowerCase().endsWith('.zip')) return false;\r\n      return validateFileName(file.name);\r\n    });\r\n    \r\n    setFileList(validFiles);\r\n  };\r\n\r\n  const handleUploadZip = async () => {\r\n    if (fileList.length === 0) {\r\n      messageApi.error(\"Please select at least one ZIP file!\");\r\n      return;\r\n    }\r\n\r\n    // Validate all files before upload\r\n    const files: File[] = [];\r\n    const invalidFiles: string[] = [];\r\n    \r\n    for (const fileItem of fileList) {\r\n      const file = fileItem.originFileObj;\r\n      if (!file) {\r\n        invalidFiles.push(fileItem.name || \"Unknown file\");\r\n        continue;\r\n      }\r\n      \r\n      // Double check validation\r\n      if (!file.name.toLowerCase().endsWith('.zip')) {\r\n        invalidFiles.push(file.name);\r\n        continue;\r\n      }\r\n      \r\n      if (!validateFileName(file.name)) {\r\n        invalidFiles.push(file.name);\r\n        continue;\r\n      }\r\n      \r\n      files.push(file);\r\n    }\r\n\r\n    if (invalidFiles.length > 0) {\r\n      messageApi.error(\r\n        `Invalid file(s): ${invalidFiles.join(', ')}. File names must be in format STUXXXXXX.zip (e.g., STU123456.zip)`\r\n      );\r\n      return;\r\n    }\r\n\r\n    if (files.length === 0) {\r\n      messageApi.error(\"No valid files to upload!\");\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const result = await gradingGroupService.addSubmissionsByFile(group.id, {\r\n        Files: files,\r\n      });\r\n\r\n      messageApi.success(\r\n        `Added ${result.createdSubmissionsCount} submissions from ${files.length} file(s) successfully!`,\r\n        5\r\n      );\r\n      await fetchSubmissions();\r\n      setFileList([]);\r\n      onOk(); // Refresh parent component\r\n    } catch (err: any) {\r\n      console.error(\"Failed to upload files:\", err);\r\n      const errorMsg = err.response?.data?.errorMessages?.[0] || err.message || \"Failed to upload files. Please try again.\";\r\n      setError(errorMsg);\r\n      messageApi.error(errorMsg);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteSubmissions = async (submissionIds: number[]) => {\r\n    if (submissionIds.length === 0) {\r\n      messageApi.warning(\"Please select submissions to delete\");\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      // Delete each submission using the DELETE API\r\n      await Promise.all(\r\n        submissionIds.map((id) => submissionService.deleteSubmission(id))\r\n      );\r\n\r\n      messageApi.success(`Deleted ${submissionIds.length} submission(s) successfully!`);\r\n      await fetchSubmissions();\r\n      setSelectedRowKeys([]);\r\n      onOk(); // Refresh parent component\r\n    } catch (err: any) {\r\n      console.error(\"Failed to delete submissions:\", err);\r\n      const errorMsg = err.response?.data?.errorMessages?.[0] || err.message || \"Failed to delete submissions.\";\r\n      setError(errorMsg);\r\n      messageApi.error(errorMsg);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const submissionColumns: TableProps<GradingGroupSubmission>[\"columns\"] = [\r\n    {\r\n      title: \"ID\",\r\n      dataIndex: \"id\",\r\n      key: \"id\",\r\n      width: 80,\r\n    },\r\n    {\r\n      title: \"Student\",\r\n      dataIndex: \"studentName\",\r\n      key: \"student\",\r\n      render: (name, record) => (\r\n        <div>\r\n          <Text strong>{name}</Text>\r\n          <br />\r\n          <Text type=\"secondary\" style={{ fontSize: 12 }}>\r\n            {record.studentCode}\r\n          </Text>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      title: \"Submitted At\",\r\n      dataIndex: \"submittedAt\",\r\n      key: \"submittedAt\",\r\n      render: (date) => date ? new Date(date).toLocaleString() : \"N/A\",\r\n    },\r\n    {\r\n      title: \"Status\",\r\n      dataIndex: \"status\",\r\n      key: \"status\",\r\n      width: 120,\r\n      render: (status) =>\r\n        status === 0 ? (\r\n          <Tag color=\"green\">On Time</Tag>\r\n        ) : (\r\n          <Tag color=\"red\">Late</Tag>\r\n        ),\r\n    },\r\n    {\r\n      title: \"Score\",\r\n      dataIndex: \"lastGrade\",\r\n      key: \"score\",\r\n      width: 100,\r\n      render: (grade) => <Text>{grade !== null && grade !== undefined ? `${grade}/100` : \"N/A\"}</Text>,\r\n    },\r\n  ];\r\n\r\n  const rowSelection = {\r\n    selectedRowKeys,\r\n    onChange: (selectedKeys: React.Key[]) => {\r\n      setSelectedRowKeys(selectedKeys);\r\n    },\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title={\r\n        <Space>\r\n          <Title level={4} style={{ margin: 0 }}>\r\n            Manage Submissions - {group.lecturerName}\r\n          </Title>\r\n        </Space>\r\n      }\r\n      open={open}\r\n      onCancel={onCancel}\r\n      footer={null}\r\n      width={1000}\r\n      destroyOnClose\r\n    >\r\n      {error && (\r\n        <Alert\r\n          message={error}\r\n          type=\"error\"\r\n          showIcon\r\n          style={{ marginBottom: 16 }}\r\n          closable\r\n          onClose={() => setError(null)}\r\n        />\r\n      )}\r\n\r\n      <Tabs\r\n        activeKey={activeTab}\r\n        onChange={setActiveTab}\r\n        items={[\r\n          {\r\n            key: \"list\",\r\n            label: \"Submissions List\",\r\n            children: (\r\n              <Space direction=\"vertical\" style={{ width: \"100%\" }} size=\"middle\">\r\n                <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n                  <Text strong>Total: {submissions.length} submissions</Text>\r\n                  {selectedRowKeys.length > 0 && (\r\n                    <Popconfirm\r\n                      title={`Delete ${selectedRowKeys.length} submission(s)`}\r\n                      description=\"Are you sure you want to delete these submissions?\"\r\n                      onConfirm={() => handleDeleteSubmissions(selectedRowKeys.map(Number))}\r\n                      okText=\"Yes\"\r\n                      cancelText=\"No\"\r\n                    >\r\n                      <Button\r\n                        danger\r\n                        icon={<DeleteOutlined />}\r\n                        loading={isLoading}\r\n                      >\r\n                        Delete Selected ({selectedRowKeys.length})\r\n                      </Button>\r\n                    </Popconfirm>\r\n                  )}\r\n                </div>\r\n                <Table\r\n                  rowSelection={rowSelection}\r\n                  columns={submissionColumns}\r\n                  dataSource={submissions}\r\n                  rowKey=\"id\"\r\n                  loading={loadingSubmissions}\r\n                  pagination={{ pageSize: 10 }}\r\n                  scroll={{ y: 400 }}\r\n                />\r\n              </Space>\r\n            ),\r\n          },\r\n          {\r\n            key: \"upload\",\r\n            label: (\r\n              <Space>\r\n                <FileZipOutlined />\r\n                <span>Upload ZIP File</span>\r\n              </Space>\r\n            ),\r\n            children: (\r\n              <Space direction=\"vertical\" style={{ width: \"100%\" }} size=\"large\">\r\n                <Card style={{ backgroundColor: \"#f0f9ff\" }}>\r\n                  <Space direction=\"vertical\" style={{ width: \"100%\" }} size=\"middle\">\r\n                    <Text strong>Upload ZIP files containing submissions</Text>\r\n                    <Text type=\"secondary\" style={{ fontSize: 12 }}>\r\n                      ZIP files will be extracted and submissions will be created automatically. \r\n                      Only ZIP files are accepted, maximum size 100MB per file.\r\n                      <br />\r\n                      <Text strong style={{ color: \"#ff4d4f\" }}>\r\n                        File name format: STUXXXXXX.zip (e.g., STU123456.zip) where X is a digit.\r\n                      </Text>\r\n                    </Text>\r\n                  </Space>\r\n                </Card>\r\n                <Dragger\r\n                  fileList={fileList}\r\n                  beforeUpload={beforeUpload}\r\n                  onChange={handleFileChange}\r\n                  accept=\".zip,application/zip,application/x-zip-compressed\"\r\n                  multiple\r\n                >\r\n                  <p className=\"ant-upload-drag-icon\">\r\n                    <InboxOutlined style={{ fontSize: 48, color: \"#1890ff\" }} />\r\n                  </p>\r\n                  <p className=\"ant-upload-text\">Click or drag ZIP files here</p>\r\n                  <p className=\"ant-upload-hint\">\r\n                    You can select multiple files. File names must be in format STUXXXXXX.zip (e.g., STU123456.zip).\r\n                    Files will be uploaded when you click \"Upload\".\r\n                  </p>\r\n                </Dragger>\r\n                {fileList.length > 0 && (\r\n                  <Card size=\"small\">\r\n                    <Space direction=\"vertical\" style={{ width: \"100%\" }} size=\"small\">\r\n                      <Text strong>Selected files ({fileList.length}):</Text>\r\n                      {fileList.map((file, index) => (\r\n                        <div key={index} style={{ display: \"flex\", alignItems: \"center\", gap: 8 }}>\r\n                          <FileZipOutlined />\r\n                          <Text>{file.name}</Text>\r\n                          <Text type=\"secondary\">\r\n                            ({(file.size! / 1024 / 1024).toFixed(2)} MB)\r\n                          </Text>\r\n                        </div>\r\n                      ))}\r\n                    </Space>\r\n                  </Card>\r\n                )}\r\n                <div style={{ display: \"flex\", justifyContent: \"flex-end\", gap: 8 }}>\r\n                  <Button onClick={onCancel}>Cancel</Button>\r\n                  <Button\r\n                    type=\"primary\"\r\n                    onClick={handleUploadZip}\r\n                    loading={isLoading}\r\n                    disabled={fileList.length === 0}\r\n                  >\r\n                    Upload\r\n                  </Button>\r\n                </div>\r\n              </Space>\r\n            ),\r\n          },\r\n        ]}\r\n      />\r\n    </Modal>\r\n  );\r\n};\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/components/examiner/AssignSubmissionsModal.tsx b/src/components/examiner/AssignSubmissionsModal.tsx
--- a/src/components/examiner/AssignSubmissionsModal.tsx	(revision fb5cf06ab6bd16fba48a33020918a07ce520669e)
+++ b/src/components/examiner/AssignSubmissionsModal.tsx	(date 1762916779964)
@@ -134,7 +134,7 @@
     
     for (const fileItem of fileList) {
       const file = fileItem.originFileObj;
-      if (!file) {
+    if (!file) {
         invalidFiles.push(fileItem.name || "Unknown file");
         continue;
       }
@@ -386,11 +386,11 @@
                       <Text strong>Selected files ({fileList.length}):</Text>
                       {fileList.map((file, index) => (
                         <div key={index} style={{ display: "flex", alignItems: "center", gap: 8 }}>
-                          <FileZipOutlined />
+                      <FileZipOutlined />
                           <Text>{file.name}</Text>
-                          <Text type="secondary">
+                      <Text type="secondary">
                             ({(file.size! / 1024 / 1024).toFixed(2)} MB)
-                          </Text>
+                      </Text>
                         </div>
                       ))}
                     </Space>
